<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>×¤×•×“×§××¡×˜ ×—× ×§</title>
<link rel="icon" type="image/png" href="logo.png">

<style>
:root {
    --deep-blue:#0d1b2a;
    --light-blue:#1b263b;
    --accent-blue:#415a77;
    --text-color:#e0e1dd;
}
*{box-sizing:border-box}
body{
    margin:0;
    padding:20px;
    font-family:Arial;
    background:var(--deep-blue);
    color:var(--text-color);
}
body.loading{overflow:hidden}

/* ×¡×¤×œ×© */
#splash{
    position:fixed; inset:0;
    display:flex; align-items:center; justify-content:center;
    background:var(--deep-blue);
    z-index:9999;
}
#splashLogo{
    width:120px;
    animation:spin 2s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* ×¡×¨×’×œ ×¢×œ×™×•×Ÿ */
#topBar{
    position:fixed;
    top:10px; left:10px; right:10px;
    display:flex;
    justify-content:space-between;
    z-index:1000;
}
#profileBtn{
    width:50px;height:50px;
    border-radius:50%;
    border:none;
    background:red;
    color:#fff;
    font-size:24px;
    cursor:pointer;
}
#topLogo{width:50px;cursor:pointer}

h1{
    margin-top:80px;
    text-align:center;
    color:var(--accent-blue);
}
#userNameDisplay{text-align:center;margin-bottom:20px}

/* Grid */
.grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(380px,1fr));
    gap:25px;
}
.card{
    background:var(--light-blue);
    border-radius:12px;
    padding:15px;
    box-shadow:0 8px 20px rgba(0,0,0,.5);
    text-align:center;
    transform:scale(.9);
    opacity:0;
    transition:.7s;
}
.card.show{transform:scale(1);opacity:1}
.card iframe{
    width:100%;
    height:300px;
    border-radius:8px;
    border:none;
}

.download-btn{
    margin-top:12px;
    padding:8px 16px;
    background:var(--accent-blue);
    border:none;
    border-radius:8px;
    color:#fff;
    cursor:pointer;
}
.download-btn:hover{opacity:.85}

@media(max-width:768px){.card iframe{height:220px}}
@media(max-width:480px){.card iframe{height:180px}}
</style>
</head>

<body class="loading" data-category="×¤×•×“×§××¡×˜ ×—× ×§">

<div id="splash">
    <img src="logo.png" id="splashLogo">
</div>

<div id="topBar">
    <button id="profileBtn">ğŸ‘¤</button>
    <img src="logo.png" id="topLogo">
</div>

<h1>×¤×•×“×§××¡×˜ ×—× ×§</h1>
<div id="userNameDisplay"></div>
<div class="grid" id="mediaGrid"></div>

<script>
const user=JSON.parse(localStorage.getItem('loggedInUser'));
if(!user) location.href='login1.html';
else userNameDisplay.textContent=`×©×œ×•×, ${user.firstName} ${user.lastName}`;

profileBtn.onclick=()=>location.href='login1.html';
topLogo.onclick=()=>location.href='media-index.html';

const csvUrl='https://docs.google.com/spreadsheets/d/e/2PACX-1vSDcF3fujTQ-PQG1vd2QJkFWkzXoUOTwPsQ1gglHXKeN1XynSddJVs4EMGK744t3D2hnRuM891-HVzU/pub?output=csv';

async function loadMedia(){
    const res=await fetch(csvUrl);
    const rows=(await res.text()).split('\n').map(r=>r.split(','));
    const grid=document.getElementById('mediaGrid');
    const category=document.body.dataset.category;

    rows.forEach((r,i)=>{
        if(i===0) return;
        const title=r[1]?.trim();
        const link=r[2]?.trim();
        const cat=r[3]?.trim();
        if(!title||!link||cat!==category) return;

        const card=document.createElement('div');
        card.className='card';

        const h2=document.createElement('h2');
        h2.textContent=title;

        const iframe=document.createElement('iframe');
        let previewSrc=link;
        let downloadSrc=link;

        /* YouTube */
        if(link.includes('youtube')){
            previewSrc=link.replace('watch?v=','embed/');
            downloadSrc=null; // ××™×Ÿ ×”×•×¨×“×” ×œ×™×•×˜×™×•×‘
        }

        /* Google Drive */
        if(link.includes('drive.google.com')){
            const match=link.match(/\/d\/(.+?)\//) || link.match(/id=(.+)/);
            if(match){
                const id=match[1];
                previewSrc=`https://drive.google.com/file/d/${id}/preview`;
                downloadSrc=`https://drive.google.com/uc?export=download&id=${id}`;
            }
        }

        iframe.src=previewSrc;
        iframe.allowFullscreen=true;

        card.append(h2,iframe);

        if(downloadSrc){
            const btn=document.createElement('button');
            btn.className='download-btn';
            btn.textContent='â¬‡ ×”×•×¨×“×”';
            btn.onclick=()=>window.open(downloadSrc,'_blank');
            card.appendChild(btn);
        }

        grid.appendChild(card);
        setTimeout(()=>card.classList.add('show'),i*120);
    });
}

(async()=>{
    await loadMedia();
    splash.style.display='none';
    document.body.classList.remove('loading');
})();
</script>

</body>
</html>
