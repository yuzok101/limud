<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>专转 拽爪</title>
<link rel="icon" type="image/png" href="logo.png">

<style>
:root {
    --deep-blue:#0d1b2a;
    --light-blue:#1b263b;
    --accent-blue:#415a77;
    --text-color:#e0e1dd;
}
*{box-sizing:border-box}
body{
    margin:0;
    padding:20px;
    font-family:Arial;
    background:var(--deep-blue);
    color:var(--text-color);
}
body.loading{overflow:hidden}

/* 住驻砖 */
#splash{
    position:fixed; inset:0;
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    background:var(--deep-blue);
    z-index:9999;
}
#splashLogo{
    width:120px;
    animation:spin 2s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* 爪转 拽转 */
#loadingText{
    color:white; 
    margin-top:20px; 
    font-size:18px; 
    display:flex; 
    justify-content:center; 
    align-items:center;
}
.dot{
    opacity:0;
    margin-left:2px;
    animation:fadeDots 1.5s infinite;
}
.dot:nth-child(1){animation-delay:0s}
.dot:nth-child(2){animation-delay:0.5s}
.dot:nth-child(3){animation-delay:1s}
@keyframes fadeDots{
    0%,20%{opacity:0}
    40%,60%{opacity:1}
    80%,100%{opacity:0}
}

/* 住专 注 */
#topBar{
    position:fixed;
    top:10px; left:10px; right:10px;
    display:flex;
    justify-content:space-between;
    z-index:1000;
}
#profileBtn{
    width:50px;height:50px;
    border-radius:50%;
    border:none;
    background:red;
    color:#fff;
    font-size:24px;
    cursor:pointer;
}
#topLogo{width:50px;cursor:pointer}

h1{
    margin-top:80px;
    text-align:center;
    color:var(--accent-blue);
}
#userNameDisplay{text-align:center;margin-bottom:20px}

/* Grid */
.grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(380px,1fr));
    gap:25px;
}
.card{
    background:var(--light-blue);
    border-radius:12px;
    padding:15px;
    box-shadow:0 8px 20px rgba(0,0,0,.5);
    text-align:center;
    transform:scale(.9);
    opacity:0;
    transition:.7s;
}
.card.show{transform:scale(1);opacity:1}

.preview-box{
    width:100%;
    height:300px;
    border-radius:8px;
    background:#000;
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:hidden;
}
.preview-box img{
    width:100%;
    height:100%;
    object-fit:contain;
}

.download-btn{
    margin-top:12px;
    padding:8px 16px;
    background:var(--accent-blue);
    border:none;
    border-radius:8px;
    color:#fff;
    cursor:pointer;
}
.download-btn:hover{opacity:.85}

@media(max-width:768px){.preview-box{height:220px}}
@media(max-width:480px){.preview-box{height:180px}}
</style>
</head>

<body class="loading" data-category="专转 拽爪">

<div id="splash">
    <img src="logo.png" id="splashLogo">
    <div id="loadingText"> 转<span class="dot">.</span><span class="dot">.</span><span class="dot">.</span></div>
</div>

<div id="topBar">
    <button id="profileBtn"></button>
    <img src="logo.png" id="topLogo">
</div>

<h1>专转 拽爪</h1>
<div id="userNameDisplay"></div>
<div class="grid" id="mediaGrid"></div>

<script>
const user=JSON.parse(localStorage.getItem('loggedInUser'));
if(!user) location.href='login1.html';
else userNameDisplay.textContent=`砖, ${user.firstName} ${user.lastName}`;

profileBtn.onclick=()=>location.href='login1.html';
topLogo.onclick=()=>location.href='media-index.html';

/* ===== 专住 拽注 砖 住驻专 ===== */
const grid=document.getElementById('mediaGrid');

const bookCard=document.createElement('div');
bookCard.className='card show';

bookCard.innerHTML=`
    <h2>'拽 拽, 住驻专 拽专住, 注 注''驻 驻专拽 2025 砖 AHA</h2>
    <div class="preview-box">
        <img src="images/sefer.png" alt="住驻专 拽专住">
    </div>
    <button class="download-btn"
        onclick="window.open('https://drive.google.com/open?id=1KzG3ah6Hs4sjQ5xF2EXtrRQC1RLQl2-I','_blank')">
        专
    </button>
`;

grid.appendChild(bookCard);

/* ===== 注转 砖专 转 志CSV ( 砖转) ===== */
const csvUrl='https://docs.google.com/spreadsheets/d/e/2PACX-1vSDcF3fujTQ-PQG1vd2QJkFWkzXoUOTwPsQ1gglHXKeN1XynSddJVs4EMGK744t3D2hnRuM891-HVzU/pub?output=csv';

async function loadMedia(){
    const res=await fetch(csvUrl);
    const rows=(await res.text()).split('\n').map(r=>r.split(','));
    const category=document.body.dataset.category;

    rows.forEach((r,i)=>{
        if(i===0) return;
        const title=r[1]?.trim();
        const link=r[2]?.trim();
        const cat=r[3]?.trim();
        if(!title||!link||cat!==category) return;

        const card=document.createElement('div');
        card.className='card';

        const h2=document.createElement('h2');
        h2.textContent=title;

        const iframe=document.createElement('iframe');
        let previewSrc=link;
        let downloadSrc=link;

        if(link.includes('youtube')){
            previewSrc=link.replace('watch?v=','embed/');
            downloadSrc=null;
        }

        if(link.includes('drive.google.com')){
            const match=link.match(/\/d\/(.+?)\//) || link.match(/id=(.+)/);
            if(match){
                const id=match[1];
                previewSrc=`https://drive.google.com/file/d/${id}/preview`;
                downloadSrc=`https://drive.google.com/uc?export=download&id=${id}`;
            }
        }

        iframe.src=previewSrc;
        iframe.allowFullscreen=true;

        card.append(h2,iframe);

        if(downloadSrc){
            const btn=document.createElement('button');
            btn.className='download-btn';
            btn.textContent='专';
            btn.onclick=()=>window.open(downloadSrc,'_blank');
            card.appendChild(btn);
        }

        grid.appendChild(card);
        setTimeout(()=>card.classList.add('show'),i*120);
    });

    splash.style.display='none';
    document.body.classList.remove('loading');
}

loadMedia();
</script>

</body>
</html>
