<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>הקורסים שלי</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Assistant:wght@400;700&display=swap');

body {
    margin: 0;
    font-family: 'Assistant', sans-serif;
    background: #0b1f3a;
    color: #fff;
    min-height: 100vh;
}

header {
    background: #0a1630;
    padding: 20px;
    text-align: center;
    font-size: 2rem;
    font-weight: bold;
    color: #00aaff;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
}

.container {
    max-width: 1200px;
    margin: 30px auto;
    padding: 0 20px;
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(280px,1fr));
    gap: 20px;
}

.card {
    background: #12294f;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

.card h3 {
    margin-top: 0;
    color: #00aaff;
}

.card button {
    margin-top: 10px;
    background: #005f99;
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 10px 15px;
    cursor: pointer;
    font-weight: bold;
    transition: background 0.3s;
}

.card button:hover {
    background: #00aaff;
}
</style>
</head>
<body>

<header>הקורסים שלי</header>

<div class="container" id="coursesContainer">
  <!-- כרטיסי קורסים וסרטונים יתווספו כאן -->
</div>

<script>
const API_URL = "הכנס כאן את כתובת ה-Web App שלך";
const userId = sessionStorage.getItem("userId") || "demoUser"; // מזהה משתמש (לפי מערכת login שלך)

function fetchCourses() {
  fetch(`${API_URL}?action=getCourses`)
    .then(res=>res.json())
    .then(courses=>{
      courses.forEach(course=>{
        addCourseCard(course);
      });
    });
}

function addCourseCard(course){
  const container = document.getElementById("coursesContainer");
  const card = document.createElement("div");
  card.className = "card";
  card.innerHTML = `
    <h3>${course.title}</h3>
    <p>${course.description}</p>
    ${course.lessons.map(lesson=>`
      <div style="margin-top:10px;">
        <strong>${lesson.title}</strong><br>
        <video width="100%" controls onplay="registerView('${course.courseId}','${lesson.lessonId}')">
          <source src="${lesson.videoUrl}" type="video/mp4">
          הדפדפן שלך לא תומך בסרטונים.
        </video>
      </div>
    `).join('')}
  `;
  container.appendChild(card);
}

// רשימת צפייה בסרטון
function registerView(courseId, lessonId){
  // מעדכן צפייה ב-VideoViews
  fetch(`${API_URL}?action=addVideoView&userId=${userId}&courseId=${courseId}&lessonId=${lessonId}`)
    .then(res=>res.json())
    .then(data=>{
      if(data.success){
        console.log(`צפייה רשומה: קורס ${courseId}, שיעור ${lessonId}`);
        updateLessonStatus(courseId, lessonId);
      }
    });
}

// עדכון סטטוס שיעור ל-InProgress אם לא הושלם
function updateLessonStatus(courseId, lessonId){
  fetch(`${API_URL}?action=updateLessonStatus&userId=${userId}&courseId=${courseId}&lessonId=${lessonId}&status=InProgress`)
    .then(res=>res.json())
    .then(data=>{
      if(data.success){
        console.log(`סטטוס שיעור מעודכן`);
      }
    });
}

// טעינת הקורסים כשנטען הדף
fetchCourses();
</script>

</body>
</html>
